\documentclass[10pt,a4paper]{ctexbook}

\usepackage{amsmath}  
  \renewcommand{\CTEXthechapter}{\thechapter}
% 最小行间间距设定
\setlength{\lineskiplimit}{3pt}
\setlength{\lineskip}{3pt}

% 颜色
\usepackage[table]{xcolor}
  \newcommand{\scol}[1]{\colorbox{#1}{\rule{0em}{1ex}}\,#1}
  
% 首字下沉
\usepackage{lettrine}

% 分栏
\usepackage{multicol}
  \setlength{\columnsep}{20pt}
  \setlength{\columnseprule}{0.4pt}

% 数学环境
\usepackage{amssymb}
\usepackage{mathrsfs} % 线性代数字体
% overline的替代命令
\newcommand{\closure}[2][3]{{}\mkern#1mu\overline{\mkern-#1mu#2}}
\usepackage{yhmath} % \wideparen命令：弧AB
\usepackage{mathdots} % 数学省略号
\usepackage{mathtools} % dcases环境，prescript命令
\usepackage{amsthm} % 定理环境
\usepackage{esint} % 多重积分，需放在amsmath后
% 箭头与长等号
\usepackage{extarrows}
% 中括号的类二项式命令
\newcommand{\Bfrac}[2]{\genfrac{[}{]}{0pt}{}{#1}{#2}}

% 下划线宏包
\usepackage[normalem]{ulem}
% LaTeX符号宏包
\usepackage{hologo}
	\newcommand{\xelatex}{\Hologo{XeLaTeX}}
	\newcommand{\bibtex}{\Hologo{BibTeX}}
	\newcommand{\tikzz}{TikZ}
% 其他符号
\usepackage{wasysym}
% 带箱小页
\usepackage{boxedminipage}
% 绘图
\usepackage{tikz}
  \usetikzlibrary{calc}
  \newcommand{\tikzline}[1]{{#1\tikz{\draw[#1,line width=9](0,0)--(0.5,0);}}, }
% 最后一页
\usepackage{lastpage}

% 奇怪的小定义
\newcommand{\dpar}{\\ \mbox{}}  % 空两行
\newcommand{\qd}[1]{{\bfseries{#1}}}  % 强调
\newcommand{\co}[1]{{\bfseries{#1}}}  % Style of concept
\newcommand{\RED}[1]{{\color{cyan}{#1}}}
\newcommand{\cmmd}[1]{\fbox{\texttt{\char92{}#1}}}
\newcommand{\charef}[1]{第\ref{#1}章}
\newcommand{\secref}[1]{第\ref{#1}节}
\newcommand{\pref}[1]{第\pageref{#1}页}
\newcommand{\fref}[1]{图\ref{#1}}
\newcommand{\tref}[1]{表\ref{#1}}

% Quote 环境
\newenvironment{QuoteEnv}[2][]
    {\newcommand\Qauthor{#1}\newcommand\Qref{#2}}
    {\medskip\begin{flushright}\small ——~\Qauthor\\
    \emph{\Qref}\end{flushright}}
% 字体调用
\newcommand{\myfont}[2]{{\fontfamily{#1}\selectfont #2}}

% 编号列表宏包，并自定义了三个列表
\usepackage[inline]{enumitem}
	\setlist[enumerate]{font=\bfseries,itemsep=0pt}
	\setlist[itemize]{font=\bfseries,leftmargin=\parindent}
	\setlist[description]{font=\bfseries\uline}

\newenvironment{fead}{	
    \begin{description}[font=\bfseries\uline,labelindent=\parindent,itemsep=0pt,parsep=0pt,topsep=0pt,partopsep=0pt]}
	{\end{description}}
% 带宽度的
\newenvironment{para}{
	\begin{description}[font=\bfseries\ttfamily,itemsep=0pt,parsep=0pt,topsep=0pt,partopsep=0pt]}
	{\end{description}}
\newenvironment{feae}{
	\begin{enumerate}[font=\bfseries,labelindent=0pt,itemsep=0pt,parsep=0pt,topsep=0pt,partopsep=0pt]}
	{\end{enumerate}}
\newenvironment{feai}{
	\begin{itemize}[font=\bfseries,itemsep=0pt,parsep=0pt,topsep=0pt,partopsep=0pt]}
	{\end{itemize}}
\newenvironment{inlinee}
{\begin{enumerate*}[label=(\arabic*), font=\rmfamily, before=\unskip{：},itemjoin={{；}},itemjoin*={{，以及：}}]}
	{\end{enumerate*}。}

% 目录和章节样式
\usepackage{titlesec}
\usepackage{titletoc}   % 用于目录

\titlecontents{chapter}[1.5em]{}{\contentslabel{1.5em}}{\hspace*{-2em}}{\hfill\contentspage}
\titlecontents{section}[3.3em]{}{\contentslabel{1.8em}}
	{\hspace*{-2.3em}}{\titlerule*[8pt]{$\cdot$}\contentspage}
\titlecontents*{subsection}[2.5em]{\small}{\thecontentslabel{} }{}{, \thecontentspage}[;\qquad][.]
% 章节样式
\setcounter{secnumdepth}{3} % 一直到subsubsection
\newcommand{\chaformat}[1]{%
	\parbox[b]{.5\textwidth}{\hfill\bfseries #1}%
	\quad\rule[-12pt]{2pt}{70pt}\quad
	{\fontsize{60}{60}\selectfont\thechapter}}
\titleformat{\chapter}[block]{\hfill\LARGE\sffamily}{}{0pt}{\chaformat}[\vspace{2.5pc}\normalsize
	\startcontents\setlength{\lineskiplimit}{0pt}\printcontents{}{1}{\setcounter{tocdepth}{2}\songti}]
\titleformat*{\section}{\centering\Large\bfseries}
\titleformat{\subsubsection}[hang]{\bfseries\large}{\rule{1.5ex}{1.5ex}}{0.5em}{}
% 扩展章节
\newcommand{\starsec}{\noindent\fbox{\S\textit{注意：本章节是一个扩展阅读章节。}}
	\\ \mbox{}}

\renewcommand{\contentsname}{目录}
	\renewcommand{\tablename}{表}
	\renewcommand\arraystretch{1.2}	% 表格行距
	\renewcommand{\figurename}{图}
% 设置不需要浮动体的表格和图像标题
\setlength{\abovecaptionskip}{5pt}
\setlength{\belowcaptionskip}{3pt}
\makeatletter
\newcommand\figcaption{\def\@captype{figure}\caption}
\newcommand\tabcaption{\def\@captype{table}\caption}
\makeatother
% 图表
\usepackage{array,multirow,makecell}
  \setlength\extrarowheight{2pt} % 行高增加
\usepackage{diagbox}
\usepackage{longtable}
\usepackage{graphicx,wrapfig}
  \graphicspath{{./tikz/}}
\usepackage{animate}
\usepackage{caption,subcaption}
  \captionsetup[sub]{labelformat=simple}
  \renewcommand{\thesubtable}{(\alph{subtable})}
% 三线表
\usepackage{booktabs}  

% 页面修正宏包
\usepackage{geometry}
  \geometry{vmargin = 1in}

% 代码环境
\usepackage{listings}
% 复制代码时不复制行号
\usepackage{accsupp}
	\newcommand{\emptyaccsupp}[1]
	{\BeginAccSupp{ActualText={}}#1\EndAccSupp{}}
	
\usepackage{tcolorbox} 
	\tcbuselibrary{listings,skins,breakable}

\newtcbox{\latexCommand}[1][green]{on line,
	before upper=\char`\\, arc=2pt,outer arc=2pt, 
	colback=#1!10!white, colframe=#1!50!black, boxsep=1pt, 
	left=1pt, right=1pt, top=1pt, bottom=1pt,
	boxrule=0pt, bottomrule=1pt, toprule=1pt}
  
\newtcbox{\latexEnvironment}[1][violet!70!cyan]{on line,
	before upper=\ttfamily,arc=0pt,outer arc=0pt,
	colback=#1!10!white,colframe=#1!50!black,
	boxsep=0pt,left=1pt, right=1pt, top=1pt, bottom=1pt,
	boxrule=0pt, bottomrule=1pt, toprule=1pt}

\newtcbox{\latexPackage}[1][orange!70!red]{on line,
	before upper={\rule[-0.2ex]{0pt}{1ex}\ttfamily},
	arc=0.8ex,colback=#1!30!white, colframe=#1!50!black,
	boxsep=0pt, left=1.5pt, right=1.5pt, top=1pt, bottom=1pt, boxrule=1pt}


\newtcblisting{latexCode}{breakable,
	skin=bicolor, listing only, 
	colback=gray!30!white, colbacklower=white, colframe=cyan!75!black,
	left=6mm, top=2pt, bottom=2pt, fontupper=\small,
	% listing style
	listing options={style=tcblatex,
		keywordstyle=\color{blue}, 
		breaklines = true,
		commentstyle=\color{green!50!black},
		numbers=left,
		numberstyle=\tiny\color{red!75!black}\emptyaccsupp,
		emptylines=1,
		escapeinside=``}
}

\newtcblisting{cppCode}[1]{breakable,
	title=#1, fonttitle=\bfseries,
	skin=bicolor, listing only, 
	colback=gray!30!white, colbacklower=white, colframe=cyan!75!black,
	left=6mm, top=2pt, bottom=2pt, fontupper=\small,
	% listing style
	listing options={language=c++,
		keywordstyle=\color{blue}, 
		commentstyle=\color{green!50!black},
		numbers=left,
		numberstyle=\tiny\color{red!75!black}\emptyaccsupp,
		emptylines=1,
		escapeinside=``}
}

\newtcblisting{csCode}[1]{breakable,
	title=#1, fonttitle=\bfseries,
	skin=bicolor, listing only, 
	colback=gray!30!white, colbacklower=white, colframe=cyan!75!black,
	left=6mm, top=2pt, bottom=2pt, fontupper=\small,
	% listing style
	listing options={language=csh,
		keywordstyle=\color{blue}, 
		commentstyle=\color{green!50!black},
		numbers=left,
		numberstyle=\tiny\color{red!75!black}\emptyaccsupp,
		emptylines=1,
		escapeinside=``}
}

\newtcblisting{rCode}{breakable,
	skin=bicolor, listing only, 
	colback=gray!30!white, colbacklower=white, colframe=cyan!75!black,
	left=6mm, top=2pt, bottom=2pt, fontupper=\small,
	% listing style
	listing options={language=R,
		keywordstyle=\color{blue}, 
		commentstyle=\color{green!50!black},
		numbers=left,
		numberstyle=\tiny\color{red!75!black}\emptyaccsupp,
		emptylines=1,
		escapeinside=``}
}

\newtcblisting{perlCode}{breakable,
	skin=bicolor, listing only, 
	colback=gray!30!white, colbacklower=white, colframe=cyan!75!black,
	left=6mm, top=2pt, bottom=2pt, fontupper=\small,
	% listing style
	listing options={language=Perl,
		keywordstyle=\color{blue}, 
		commentstyle=\color{green!50!black},
		numbers=left,
		numberstyle=\tiny\color{red!75!black}\emptyaccsupp,
		emptylines=1,
		escapeinside=``}
}

\newtcblisting{pythonCode}{breakable,
	skin=bicolor, listing only, 
	colback=gray!30!white, colbacklower=white, colframe=cyan!75!black,
	left=6mm, top=2pt, bottom=2pt, fontupper=\small,
	% listing style
	listing options={language=Python,
		keywordstyle=\color{blue}, 
		commentstyle=\color{green!50!black},
		numbers=left,
		numberstyle=\tiny\color{red!75!black}\emptyaccsupp,
		emptylines=1,
		escapeinside=``}
}

\newtcblisting{latexCodePreview}{
	skin=bicolor,
	colback=gray!30!white, colbacklower=pink!50!yellow, colframe=cyan!75!black, 
	left=6mm, righthand width=0.4\linewidth, fontupper=\small,
	% listing style
	listing side text,
	listing options={style=tcblatex,
		keywordstyle=\color{blue},
		commentstyle=\color{green!50!black},
		numbers=left,
		numberstyle=\tiny\color{red!75!black}\emptyaccsupp,
		emptylines=1,
		escapeinside=``}
}

\newtcblisting{latexCodePreviewAbove}{
	skin=bicolor, 
	colback=gray!30!white, colbacklower=pink!50!red, colframe=cyan!75!black, 
	left=6mm, righthand width=0.4\linewidth, fontupper=\small,
	% listing style
	listing and text,
	listing options={style=tcblatex,
		keywordstyle=\color{blue},
		commentstyle=\color{green!50!black},
		numbers=left,
		numberstyle=\tiny\color{red!75!black}\emptyaccsupp,
		emptylines=1,
		escapeinside=``}
}

% Tikz Code
\newtcblisting{tikzshow}{tikz lower,
	skin=bicolor,
	colback=gray!30!white, colbacklower=white, colframe=cyan!75!black, left=6mm, righthand width=3.5cm, listing outside text,
	% listing style  
	listing options={style=tcblatex,
		language=TeX,
		basicstyle=\small\ttfamily,
		keywordstyle=\color{blue},
		commentstyle=\color{green!50!black},
		numbers=left,
		numberstyle=\tiny\color{red!75!black}\emptyaccsupp,
		emptylines=1,
		escapeinside=``}
}

\lstdefinelanguage{tikzlang}{
	classoffset=0, % 蓝色的keyword
	morekeywords={begin, end, newcommand, draw, node, 
								coordinate, tikzstyle, foreach},
	keywordstyle=\color{keywordcolor},
	classoffset=1, % 棕色的其他关键字
	morekeywords={tikzpicture,grid,at, thick,thin,very,ultra,
								red,green,yellow,blue,cyan,magenta,black,
								gray,darkgray,lightgray,brown,lime,
								olive,orange,pink,purple,teal,violet,white},
	keywordstyle=\color{envicolor},
	morecomment=[l]{\%},
	morecomment=[s]{/*}{*/},
	morestring=[b]',
	% Escape
	escapeinside=``
}

\lstnewenvironment{tikzcode}[1]
		{\lstset{language=tikzlang, 
			basicstyle=\small\ttfamily,
			breaklines=true,%backgroundcolor=\color{white},
			linewidth=0.7\linewidth,#1}
		}
		{}

% 附录
\usepackage{appendix}
\renewcommand{\appendixname}{App.}

% 行号
\usepackage{lineno}

% 索引与参考文献
\usepackage{imakeidx}
  \newcommand{\tikzidx}[1]{\index{\char`\\ #1}}
  \newcommand{\tikzoptstyle}[1]{\texttt{#1}}
  \newcommand{\tikzopt}[2][draw]{\tikzoptstyle{#2}\index{\char`\\ #1!#2}\ }
  \renewcommand{\indexname}{\tikzz 命令索引}
\makeindex[intoc]

\bibliographystyle{plain}
\renewcommand{\bibname}{参考文献}
\usepackage[numindex,numbib]{tocbibind}
\usepackage[square,super,sort&compress]{natbib}

\usepackage{hyperref}
\usepackage{hyperxmp}

\newcommand{\documentTitle}
    {\texorpdfstring{\LaTeX 项目模板}{LaTeX项目模板}}
\newcommand{\documentAuthor}{张洋}
\newcommand{\documentKeywords}{LaTeX,模板}
\newcommand{\documentSubject}{LaTeX,模板}

\hypersetup{
	pdftitle=\documentTitle,
	pdfauthor=\documentAuthor,
	pdfsubject= \documentSubject,
	pdfkeywords= \documentKeywords,
	pdfstartview=FitH,
	pdfproducer = \documentAuthor,
	pdfcreator = \documentAuthor, 
	pdfcopyright = \documentAuthor, 
	pdflicenseurl = {https://github.com/hiatcg}
}



\begin{document}
\title{\documentTitle}
\author{\documentAuthor}

%\maketitle
%\tableofcontents

\begin{latexCodePreview}
\textcolor{red}{红色}强调\\
\colorbox[gray]{0.95}{浅灰色背景}\\
\fcolorbox{blue}{cyan}{
\textcolor{blue}{蓝色边框+文字，
青色背景}}
\end{latexCodePreview}

\begin{latexCode}
\textcolor{red}{红色}强调\\
\colorbox[gray]{0.95}{浅灰色背景}\\
\fcolorbox{blue}{cyan}{
\textcolor{blue}{蓝色边框+文字，青色背景蓝色边框+文字，青色背景蓝色边框+文字，青色背景蓝色边框+文字，青色背景}}
\end{latexCode}

\begin{cppCode}{Good}
#include <string>
#include <iostream>
#include <sstream>
 
int main()
{
    // greet the user
    std::string name;
    std::cout << "What is your name? ";
    std::getline(std::cin, name);
    std::cout << "Hello " << name << ", nice to meet you.\n";
 
    // read file line by line
    std::istringstream input;
    input.str("1\n2\n3\n4\n5\n6\n7\n");
    int sum = 0;
    for (std::string line; std::getline(input, line); ) {
        sum += std::stoi(line);
    }
    std::cout << "\nThe sum is: " << sum << "\n";
}
\end{cppCode}

\begin{csCode}{csharp}
unsafe static int* Max(int* first, int* second, int* third)
{
    int* max = *first > *second ? first : second;
    return *max > *third ? max : third;
}
....
int a = 1, b = 2, c = 3;
unsafe
{
    int* max = Max(&a, &b, &c);
    *max = 4; // c == 4
}
\end{csCode}

\end{document}